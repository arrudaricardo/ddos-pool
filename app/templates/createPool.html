{% extends "base.html" %} {% block content %}
<div id='' class="container" style="padding:2em">
    <div class="columns">
        <div id='form-group'class="column col-6 col-sm-11">
            <div class="form-group">
                <label class="form-label" for="input-example-1">Name</label>
                <input class="form-input" type="text" id="poolName" placeholder="Attack Pool Name" autocomplete="off" />
            </div>

            <div class="form-group">
                <label class="form-label" for="input-example-1">Target:</label>
                <input class="form-input" type="text" id="poolTarget" placeholder="Target Adress" autocomplete="off" />
                <p style="font-size: smaller;">e.g Target:http://www.exemple.com, port:80</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="input-example-1">Comment:</label>
                <input class="form-input" type="text" id="poolComment" placeholder="Reason of the Attack" autocomplete="off" />
            </div>

            <div class="form-group">
                <label class="form-label" for="input-example-1">Attack Method:</label>
                <select id="attackType" class="form-select">
                    <option>SELECT METHOD</option>
                    <option>GET flood attack</option>
                    <option>Custom Code</option>>
                </select>
            </div>

            <div class="form-group">
                <label style="font-size: smaller;" class="form-checkbox">
                    <input  id="terms" type="checkbox" />I agree to the
                    <a href="#">terms and conditions</a> <i class="form-icon"></i>                </label>
                <button id='createBtn' class="btn m-2">Create</button>
            </div>

        </div>
        <div id='displayCode' class="column col-6 d-invisible hide-sm col-sm-0 ">
            <pre class="code" data-lang="javascript"><code id='code'> </code></pre>

        </div>

    </div>
</div>

<!-- MODAL -->
<div class="modal" id="customCodeModal">
        <a href="#close" class="modal-overlay close" aria-label="Close"></a>
        <div class="modal-container">
          <div class="modal-header">
            <a  
              href="#close"
              class="btn btn-clear float-right close"
              aria-label="Close"
            ></a>
            <div class="modal-title h5">Custom Code</div>
          </div>
          <div class="modal-body">
            <div class="content">
              <textarea
                id="CodeArea"
                class="textarea"
                placeholder="Javascript Code."
              ></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <div class="modal-footer">
              <button id="saveBtn" class="btn btn-primary">Save</button>
              <a class="btn btn-link close" href="#modals">Close</a>
            </div>
          </div>
        </div>
      </div>

{% endblock %} {% block script %}
<script>
  //create Pool
  let objx;
  window.document.getElementById("createBtn").onclick = function() {
    data = {
      'poolName': $("#poolName").val(),
      'poolTarget': $("#poolTarget").val(),
      'attackType': $("#attackType").val(),
      'terms': $("#terms").prop("checked"),
      'poolComment': $("#poolComment").val(),
      'poolPort': $("#poolPort").val(),
      'customCode': $("#CodeArea").val()
    };

    $.ajax({
      method: "POST",
      url: {{url_for('create_pool') | tojson}},
      data: data,
      success: function(response){
        console.log(response)
        // to do
        //window.location.href = response.redirect
      },
      error: function(msg){
          alert(msg)
        console.log(msg)
      }

    })

  };

  // MODAL 
  document.getElementById("attackType").onchange = function() {
    let attackType = $("#attackType").val();
    
    if ( attackType == "Custom Code") {
      $("#customCodeModal").addClass("active");
       // send basic javascript template to Custom Code text-field

       let basic_code = "window.document.getElementById('startButton').onclick = function(){\n//Function to be called.\n\n}"
       $("#CodeArea").val(basic_code)

    }else{
      //request attack script and display in displayCode area

      $.ajax({
        method: "POST",
        url: {{url_for('getAttack') | tojson}},
        data: {'attackType':attackType},
        success: function(data){
        console.log(data)
        $("#displayCode").removeClass('d-invisible');
        $("#code").text(data);
        },
        error: function(msg){
          console.log(msg)
        }
      })
    }
  };

  //close modal btn
  $(".close").click(function() {
    $("#customCodeModal").removeClass("active");
    $("#CodeArea").empty();
    $("#code").empty();
    
  });
  $("#saveBtn").click(function() {
    $("#customCodeModal").removeClass("active");
    $("#displayCode").removeClass('d-invisible');
    $("#code").text($("#CodeArea").val())
  });
</script>
{% endblock %}
